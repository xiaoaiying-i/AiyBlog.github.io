<!DOCTYPE html>
<html lang="en" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="John Doe" />
  <meta name="description" content="" />
  
  
  <title>
    
      oracle基础 
      
      
      |
    
     Ai-blogs
  </title>

  
    <link rel="apple-touch-icon" href="/aiyblog/images/favicon.png">
    <link rel="icon" href="/aiyblog/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/aiyblog/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/aiyblog/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/aiyblog/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/aiyblog/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/aiyblog/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/aiyblog/atom.xml" title="Ai-blogs" type="application/atom+xml">
</head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/aiyblog">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/aiyblog/images/ailog.png" alt="">
      
    </a>
    <div class="nickname"><a href="/aiyblog">Ai-Blog</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/aiyblog/index/">
          <a href="/aiyblog/index/">首页</a>
        </li>
      
        <li class="nav-item" data-path="/aiyblog/archives/">
          <a href="/aiyblog/archives/">归档</a>
        </li>
      
        <li class="nav-item" data-path="/aiyblog/categories/">
          <a href="/aiyblog/categories/">分类</a>
        </li>
      
        <li class="nav-item" data-path="/aiyblog/tags/">
          <a href="/aiyblog/tags/">标签</a>
        </li>
      
        <li class="nav-item" data-path="/aiyblog/music/">
          <a href="/aiyblog/music/">音乐</a>
        </li>
      
        <li class="nav-item" data-path="/aiyblog/friends/">
          <a href="/aiyblog/friends/">外链</a>
        </li>
      
        <li class="nav-item" data-path="/aiyblog/about/">
          <a href="/aiyblog/about/">关于</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/aiyblog/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/aiyblog/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/aiyblog/plugins/clipboard.min.js"></script>
  
  
<script src="/aiyblog/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">oracle基础</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
          2021-04-24 14:19:52
        </span>
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="Categories"></i>
                
                <span class="span--category">
                  <a href="/aiyblog/categories/sql/" title="sql">
                    <b>#</b> sql
                  </a>
                </span>
                
              </span>
          
              <span class="post-tags">
                <i class="iconfont icon-tags mr-10" title="Tags"></i>
                
                <span class="span--tag mr-8">
                  <a href="/aiyblog/tags/sql/" title="sql">
                    #sql
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <h2 id="Oracle基础"><a href="#Oracle基础" class="headerlink" title="Oracle基础"></a>Oracle基础</h2><h3 id="单行函数："><a href="#单行函数：" class="headerlink" title="单行函数："></a>单行函数：</h3><p>作用于一行，返回一个值</p>
<ul>
<li>字符函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">upper</span>(&quot;yse&quot;) <span class="keyword">from</span> dual;<span class="comment">--结果：YES</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">lower</span>(&quot;YES&quot;) <span class="keyword">from</span> dual;<span class="comment">--结果：yse</span></span><br></pre></td></tr></table></figure>

<ul>
<li>数值函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> round(<span class="number">26.18</span>,<span class="number">1</span>) <span class="keyword">from</span> dual; <span class="comment">--四舍五入，后面参数表示保留的小数， 整数==往后保留，负数==往前保留</span></span><br><span class="line"><span class="keyword">select</span> trunc(<span class="number">56.16</span>,<span class="number">1</span>) <span class="keyword">from</span> dual; <span class="comment">--直接截取，不再看后面位数是否大于5</span></span><br><span class="line"><span class="keyword">select</span> <span class="built_in">mod</span>(<span class="number">10</span>,<span class="number">3</span>) <span class="keyword">from</span> dual; <span class="comment">--求模(取余) 结果：1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>日期函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询出emp表中所有员工入职距离现在几天</span></span><br><span class="line"><span class="keyword">select</span> sysdate<span class="operator">-</span>e.hiredate </span><br><span class="line"><span class="keyword">from</span> emp e;<span class="comment">--sysdate==当前系统时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--算出明天此刻</span></span><br><span class="line"><span class="keyword">select</span> sysdate<span class="operator">+</span><span class="number">1</span> </span><br><span class="line"><span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询出emp表中所有员工入职距离现在几月</span></span><br><span class="line"><span class="keyword">select</span> months<span class="operator">-</span><span class="keyword">between</span>(sysdate,e.hiredate) </span><br><span class="line"><span class="keyword">from</span> emp e;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询出emp表中所有员工入职距离现在几年</span></span><br><span class="line"><span class="keyword">select</span> months<span class="operator">-</span><span class="keyword">between</span>(sysdate,e.hiredate)<span class="operator">/</span><span class="number">12</span> </span><br><span class="line"><span class="keyword">from</span> emp e;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询出emp表中所有员工入职距离现在几周</span></span><br><span class="line"><span class="keyword">select</span> round((sysdate<span class="operator">-</span>e.hiredate)<span class="operator">/</span><span class="number">7</span>) </span><br><span class="line"><span class="keyword">from</span> emp e;round()<span class="operator">=</span><span class="operator">=</span>四舍五入函数</span><br></pre></td></tr></table></figure>

<ul>
<li>转换函数    </li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--时间转字符串格式</span></span><br><span class="line"><span class="keyword">select</span> to_char(sysdate,<span class="string">&#x27;fm yyyy-mm-dd hh24:mi:ss&#x27;</span>) </span><br><span class="line"><span class="keyword">from</span> dual;  fm<span class="operator">=</span><span class="operator">=</span>时分秒前不加<span class="number">0</span> <span class="number">24</span><span class="operator">=</span><span class="operator">=</span><span class="number">24</span>小时制</span><br><span class="line"></span><br><span class="line"><span class="comment">--字符串转日期</span></span><br><span class="line"><span class="keyword">select</span> to_char(<span class="string">&#x27;2020-7-13 22:41:21&#x27;</span>,<span class="string">&#x27;fm yyyy-mm-dd hh24:mi:ss&#x27;</span>) </span><br><span class="line"><span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<ul>
<li>通用函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 算出emp表中所有员工的年薪</span></span><br><span class="line"><span class="comment">--sal=月薪字段 e=emp的别名 comm=一年的奖金</span></span><br><span class="line"><span class="keyword">select</span> e.sal<span class="operator">*</span><span class="number">12</span><span class="operator">+</span>e.comm</span><br><span class="line"><span class="keyword">from</span> emp e; </span><br><span class="line"></span><br><span class="line"><span class="comment">--奖金里面有null时，null值和任意数字做算数运算，结果都是null</span></span><br><span class="line"><span class="comment">--解决：nvl()函数:如果值为null用0代替</span></span><br><span class="line"><span class="keyword">select</span> e.sal<span class="operator">*</span><span class="number">12</span><span class="operator">+</span>nvl(e.comm,<span class="number">0</span>)</span><br><span class="line"><span class="keyword">from</span> emp e;</span><br></pre></td></tr></table></figure>



<h3 id="多行函数"><a href="#多行函数" class="headerlink" title="多行函数"></a>多行函数</h3><p>作用于多行，返回一个值</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left"></th>
</tr>
</thead>
<tbody><tr>
<td align="left">count(1)</td>
<td align="left">查询总数量，<br/>1= * 表示主键即所有</td>
</tr>
<tr>
<td align="left">sum(‘字段’)</td>
<td align="left">求和</td>
</tr>
<tr>
<td align="left">max(‘字段’)</td>
<td align="left">最大值</td>
</tr>
<tr>
<td align="left">min(‘字段’)</td>
<td align="left">最小值</td>
</tr>
<tr>
<td align="left">avg(‘字段’)</td>
<td align="left">平均值</td>
</tr>
</tbody></table>
<h3 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询出每个部门的平均工资</span></span><br><span class="line"><span class="keyword">select</span> e.deptno, <span class="built_in">avg</span>(e.sal) <span class="comment">--如果加这段：,e.ename 则报错</span></span><br><span class="line"><span class="keyword">from</span> emp e </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.deptno</span><br></pre></td></tr></table></figure>

<ul>
<li>分组查询中，出现在group by后面的原始列，才能出现在select后面</li>
<li>没有出现在group by后的列，想在select后面出现，必须加上聚合函数</li>
<li>聚合函数有一个特性，可以把多行记录变成一个值</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询出平均工资高于2000的部门信息</span></span><br><span class="line"><span class="keyword">select</span> e.deptno, <span class="built_in">avg</span>(e.sal) asal  <span class="comment">--如果加这段及haveing后面用asal来判断则报错</span></span><br><span class="line"><span class="keyword">from</span> emp e</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> e.deptno</span><br><span class="line"><span class="keyword">having</span> <span class="built_in">avg</span>(e.sal)<span class="operator">&gt;</span><span class="number">2000</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>所有条件都不能使用别名来判断。</li>
</ul>
<blockquote>
<p>如：select ename,sal s from emp where s&gt;1500; –会报错，s别名不能用来判断</p>
</blockquote>
<p><strong>where和having的区别</strong></p>
<ul>
<li>where是过滤分组前的数据，having是过滤后的数据</li>
<li>表现形式：where 必须是在group by之前，having是在group by之后</li>
</ul>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>子查询返回一个值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询工资和员工SCOTT一样的员工信息</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> emp </span><br><span class="line"><span class="keyword">where</span> sal <span class="operator">=</span> (<span class="comment">-- 由于ename字段不是主键，姓名为&#x27;SCOTT&#x27;的数据可能不止一条，所以上面用等号有时会有问题 解决：用in代替等号即可</span></span><br><span class="line">    <span class="keyword">select</span> sal </span><br><span class="line">    <span class="keyword">from</span> emp </span><br><span class="line">    <span class="keyword">where</span> ename <span class="operator">=</span> <span class="string">&#x27;SCOTT&#x27;</span>;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>


<p>子查询返回一个集合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-- 查询出工资和10号部门任意员工一样的员工信息</span><br><span class="line">select * </span><br><span class="line">from emp </span><br><span class="line">where sal in (</span><br><span class="line">    select sal </span><br><span class="line">    from emp </span><br><span class="line">    where deptno = 10;</span><br><span class="line">) -- deptno==部门编号</span><br></pre></td></tr></table></figure>

<p>子查询返回一张表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询出每个部门最低工资，和最低工资员工姓名，和该员工所在部门名称</span></span><br><span class="line"><span class="comment">-- 三表联查，得到最终结果</span></span><br><span class="line"><span class="keyword">select</span> t.deptno ,t.msal,e.ename,d.dname</span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> deptno <span class="built_in">min</span>(sal) msal <span class="comment">--1-先查询每个部门最低工资 msal==最小工资字段别名</span></span><br><span class="line">    <span class="keyword">from</span> emp</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> deptno</span><br><span class="line">) t,emp e,dept d</span><br><span class="line"><span class="keyword">where</span> t.deptno <span class="operator">=</span> e.deptno <span class="keyword">and</span> t.msal <span class="operator">=</span> e.sal <span class="keyword">and</span> e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure>


<h3 id="oracle分页"><a href="#oracle分页" class="headerlink" title="oracle分页"></a>oracle分页</h3><p>rownum行号：当我们做select操作的时候，每查询出一行记录，就会在该行上加一个行号，行号从1开始，依次递增，不能跳着走</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 例：emp表工资倒叙排序后，每页五条记录，查询第二页</span></span><br><span class="line"><span class="comment">-- 第二页即：行号为6-10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 说明：排序操作会影响rownum的顺序 如：</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> emp e </span><br><span class="line"><span class="keyword">where</span> rownum <span class="operator">&lt;</span> <span class="number">4</span> </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> e.sal <span class="keyword">desc</span>; <span class="comment">--查询排序后的前三条</span></span><br><span class="line"></span><br><span class="line">解决：	</span><br><span class="line"><span class="keyword">select</span> rownum,t.<span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">    <span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">	<span class="keyword">from</span> emp e </span><br><span class="line">	<span class="keyword">order</span> <span class="keyword">by</span> e.sal <span class="keyword">desc</span></span><br><span class="line">) t </span><br><span class="line"><span class="keyword">where</span> rownum<span class="operator">&lt;</span><span class="number">4</span>;  <span class="comment">-- 先排序再加行号</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 说明：rownum行号不能使用大于&gt;</span></span><br><span class="line"><span class="keyword">select</span> rownum,e.<span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">	 <span class="keyword">from</span> emp e </span><br><span class="line">	 <span class="keyword">order</span> <span class="keyword">by</span> e.sal <span class="keyword">desc</span></span><br><span class="line">) </span><br><span class="line"><span class="keyword">where</span> rownum<span class="operator">&lt;</span><span class="number">11</span> <span class="keyword">and</span> rownum<span class="operator">&gt;</span><span class="number">5</span> <span class="comment">-- 查询无数据</span></span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 正确分页查询语句：</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span>(</span><br><span class="line">	<span class="keyword">select</span> rownum rn,tt.<span class="operator">*</span></span><br><span class="line">	<span class="keyword">from</span>(</span><br><span class="line">		<span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line">		<span class="keyword">from</span> emp</span><br><span class="line">		<span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span></span><br><span class="line">    ) tt</span><br><span class="line">	<span class="keyword">order</span> <span class="keyword">by</span> e.sal <span class="keyword">desc</span></span><br><span class="line">	<span class="keyword">where</span> rownum<span class="operator">&lt;</span><span class="number">11</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">where</span> rn<span class="operator">&gt;</span><span class="number">5</span>;</span><br></pre></td></tr></table></figure>




<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p>概念：视图就是提供一个查询的窗口，所有数据来自于原表</p>
<p>视图的作用：</p>
<ul>
<li>视图可以屏蔽掉一些敏感字段。</li>
<li>保证总部和分部数据及时统一。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--查询语句创建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp </span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> scott.emp; <span class="comment">--scott==用户名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建视图[必须有dba权限]</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> v_emp </span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line"><span class="keyword">select</span> ename,job </span><br><span class="line"><span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查询视图</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> v_emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改视图(不推荐)</span></span><br><span class="line"><span class="keyword">update</span> v_emp </span><br><span class="line"><span class="keyword">set</span> job<span class="operator">=</span><span class="string">&#x27;CLERK&#x27;</span></span><br><span class="line"><span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;ALLEN&#x27;</span>;<span class="comment">--原表数据也被修改</span></span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--创建只读视图</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> v_emp1 </span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line"><span class="keyword">select</span> ename,job </span><br><span class="line"><span class="keyword">from</span> emp <span class="keyword">with</span> read <span class="keyword">only</span>;<span class="comment">--无法修改</span></span><br></pre></td></tr></table></figure>




<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>概念：索引就是在表的列上构建一个二叉树。达到大幅度提高查询效率的目的，但是索引会影响增删改的效率</p>
<p><strong>单列索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建单列索引</span></span><br><span class="line"><span class="keyword">create</span> index idx_ename <span class="keyword">on</span> emp(ename);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 触发规则：条件必须是索引列中的原始值。</span></span><br><span class="line"><span class="comment">-- 单行函数，模糊查询 都会影响索引的触发</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;SCOTT&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>复合索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建复合索引</span></span><br><span class="line"><span class="keyword">create</span> index idx_enamejob <span class="keyword">on</span> emp(ename,job);</span><br><span class="line">		</span><br><span class="line"><span class="comment">--触发规则：复合索引中第一列为优先检索列。如果要触发复合索引，必须包含有优先检索列中的原始值</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;SCOTT&#x27;</span> <span class="keyword">and</span> job<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>; <span class="comment">--会触发复合索引，有优先检索列ename=&#x27;SCOTT&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;SCOTT&#x27;</span> <span class="keyword">or</span> job<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span>;  <span class="comment">--不触发索引。相当于两个语句，一个触发一个不触发即不触发。</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename<span class="operator">=</span><span class="string">&#x27;SCOTT&#x27;</span>; 				 <span class="comment">--触发的是单列索引，既有单列也有复合，但查询为单列</span></span><br></pre></td></tr></table></figure>



<h3 id="pl-sql编程语言"><a href="#pl-sql编程语言" class="headerlink" title="pl/sql编程语言"></a>pl/sql编程语言</h3><ul>
<li>是对sql语言的扩展，是sql语言具有过程化编程的特性。</li>
<li>比一般的过程化编程语言更灵活高效。</li>
<li>主要用来编写存储过程和存储函数等。</li>
</ul>
<p><strong>声明方法：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span></span><br><span class="line">	<span class="comment">--定义一个数字变量i赋值为10</span></span><br><span class="line">	i number(<span class="number">2</span>) :<span class="operator">=</span> <span class="number">10</span>; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">--定义字符串变量s赋值为小明</span></span><br><span class="line">	s varchar2(<span class="number">10</span>) :<span class="operator">=</span> <span class="string">&#x27;小明&#x27;</span>; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">--引用型变量，定义一个emp表中ename字段类型的变量ena</span></span><br><span class="line">	ena emp.ename<span class="operator">%</span>type; </span><br><span class="line">	</span><br><span class="line">	<span class="comment">--记录型变量，定义一个存emp表中一行记录的变量，相当于一个对象</span></span><br><span class="line">	emprow emp<span class="operator">%</span>rowtype; </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	</span><br><span class="line">	dbms_output.put_line(i); <span class="comment">--输出变量i 结果：10</span></span><br><span class="line">	dbms_output.put_line(s); <span class="comment">--输出变量s 结果：小明</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">select</span> ename <span class="keyword">into</span> ena </span><br><span class="line">	<span class="keyword">from</span> emp </span><br><span class="line">	<span class="keyword">where</span> empno<span class="operator">=</span><span class="number">7788</span>; <span class="comment">--从emp表中查询一个姓名赋值给变量ena</span></span><br><span class="line">	dbms_output.put_line(ena); <span class="comment">--输出变量ena</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">into</span> emprow </span><br><span class="line">	<span class="keyword">from</span> emp </span><br><span class="line">	<span class="keyword">where</span> empno<span class="operator">=</span><span class="number">7788</span>;</span><br><span class="line">	dbms_output.put_line(emprow.ename <span class="operator">||</span><span class="string">&#x27;的工作为：&#x27;</span><span class="operator">||</span> emprow.job); <span class="comment">--结果例如==SCOTT的工作为：ANALYST</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--总结：</span></span><br><span class="line">赋值操作可以用【:<span class="operator">=</span>】也可以用【<span class="keyword">into</span>查询语句】赋值</span><br></pre></td></tr></table></figure>



<h3 id="流程结构："><a href="#流程结构：" class="headerlink" title="流程结构："></a>流程结构：</h3><p>if判断：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--输入小于18的数字，输出未成年；输入大于18小于40数字，输出中年人；输入大于40的数字，输出老年人</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">	i number(<span class="number">3</span>) :<span class="operator">=</span> <span class="operator">&amp;</span>ii; <span class="comment">--输入一个数值类型的数据并赋值给i</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	if i<span class="operator">&lt;</span><span class="number">18</span> <span class="keyword">then</span></span><br><span class="line">		dbms_output.put_line(<span class="string">&#x27;未成年&#x27;</span>);</span><br><span class="line">	elsif i<span class="operator">&lt;</span><span class="number">40</span> <span class="keyword">then</span></span><br><span class="line">		dbms_output.put_line(<span class="string">&#x27;中年人&#x27;</span>);</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		dbms_output.put_line(<span class="string">&#x27;老年人&#x27;</span>);</span><br><span class="line">	<span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p>loop循环:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--用三种方式输出1-10</span></span><br><span class="line"><span class="comment">-------------------------------------------while循环</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">	i number(<span class="number">2</span>) :<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	while i<span class="operator">&lt;</span><span class="number">11</span> loop</span><br><span class="line">		dbms_output.put_line(i);</span><br><span class="line">		i :<span class="operator">=</span> i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line">	<span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">-------------------------------------------exit循环</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">	i number(<span class="number">2</span>) :<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	loop</span><br><span class="line">		exit <span class="keyword">when</span> i<span class="operator">&gt;</span><span class="number">10</span>;</span><br><span class="line">			dbms_output.put_line(i);</span><br><span class="line">			i :<span class="operator">=</span> i<span class="operator">+</span><span class="number">1</span>;</span><br><span class="line">	<span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"><span class="comment">-------------------------------------------for循环</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.10</span> loop</span><br><span class="line">		dbms_output.put_line(i);</span><br><span class="line">	<span class="keyword">end</span> loop;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>



<h3 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h3><p>概念：可以存放多个对象，多行记录，相对于集合</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 输出emp表中所有员工的姓名及工作</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">	<span class="keyword">cursor</span> c1 <span class="keyword">is</span> </span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span> </span><br><span class="line">	<span class="keyword">from</span> emp; <span class="comment">--定义了一个游标c1，并把emp表中所有数据存入了游标</span></span><br><span class="line">	</span><br><span class="line">	emprow emp<span class="operator">%</span>rowtype; <span class="comment">--记录型变量，定义一个存emp表中一行记录的变量，相当于一个对象</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">open</span> c1;<span class="comment">--打开游标</span></span><br><span class="line">		loop</span><br><span class="line">			<span class="keyword">fetch</span> c1 <span class="keyword">into</span> emprow; <span class="comment">--把emp一行数据复制给变量emprow</span></span><br><span class="line">			exit <span class="keyword">when</span> c1<span class="operator">%</span>notfound; <span class="comment">--当游标找不到数据即最后一行时退出循环</span></span><br><span class="line">			dbms_output.put_line(emprow.ename <span class="operator">||</span><span class="string">&#x27;--&#x27;</span><span class="operator">||</span> emprow.job);</span><br><span class="line">		<span class="keyword">end</span> loop;</span><br><span class="line">	<span class="keyword">close</span> c1;<span class="comment">--关闭游标</span></span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--给指定部门员工涨工资</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">	<span class="keyword">cursor</span> c2(eno emp.deptno<span class="operator">%</span>type) <span class="keyword">is</span> </span><br><span class="line">	<span class="keyword">select</span> empno </span><br><span class="line">	<span class="keyword">from</span> emp </span><br><span class="line">	<span class="keyword">where</span> deptno<span class="operator">=</span>eno; <span class="comment">--定义了一个游标并需要传入一个参数eno</span></span><br><span class="line">	</span><br><span class="line">	en emp.empno<span class="operator">%</span>type;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">open</span> c2(<span class="number">10</span>);<span class="comment">--打开游标并传入参数10</span></span><br><span class="line">		loop</span><br><span class="line">			<span class="keyword">fetch</span> c2 <span class="keyword">into</span> en;</span><br><span class="line">			exit <span class="keyword">when</span> c2<span class="operator">%</span>notfound;</span><br><span class="line">			<span class="keyword">update</span> emp <span class="keyword">set</span> sal <span class="operator">=</span> sal<span class="operator">+</span><span class="number">100</span> <span class="keyword">where</span> empno <span class="operator">=</span> en;</span><br><span class="line">			<span class="keyword">commit</span>;</span><br><span class="line">		<span class="keyword">end</span> loop;</span><br><span class="line">	cloce c2;</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>



<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><p>概念：存储过程就是提取已经编译好的一段pl/sql语言，放置在数据库端,可以直接被调用，这一段pl/sql一般都是固定步骤的业务。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建存储过程语法： </span></span><br><span class="line"><span class="keyword">create</span> [<span class="keyword">or</span> replace] PROCEDUER 过程名[参数名 <span class="keyword">in</span><span class="operator">/</span><span class="keyword">out</span> 数据类型...]</span><br><span class="line"><span class="keyword">AS</span> 或 <span class="keyword">is</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	plsql子程序体;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 例：给指定员工涨100块钱</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">procedure</span> pl(eno emp.empno<span class="operator">%</span>type) <span class="comment">--or replace表示如果已经存在该存储过程仍可以正常执行</span></span><br><span class="line"><span class="keyword">is</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">update</span> emp <span class="keyword">set</span> sal <span class="operator">=</span> sal<span class="operator">+</span><span class="number">100</span> <span class="keyword">where</span> empno <span class="operator">=</span> eno;</span><br><span class="line">	<span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--测试存储过程p1</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	pl(<span class="number">7788</span>); <span class="comment">--结果：员工编号为7788的员工工资涨100</span></span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p><strong>out类型参数如何使用</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--使用存储过程来算年薪</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">procedure</span> p_yearsal(eno emp.empno<span class="operator">%</span>type,yearsal <span class="keyword">out</span> number) <span class="comment">--yearsal out number表示yearsal参数为输出参数</span></span><br><span class="line"><span class="keyword">is</span></span><br><span class="line">	s number(<span class="number">10</span>); <span class="comment">--存放工资</span></span><br><span class="line">	c emp.comm<span class="operator">%</span>type; <span class="comment">--存放奖金</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">select</span> sal<span class="operator">*</span><span class="number">12</span>,nvl(comm,<span class="number">0</span>) <span class="keyword">into</span> s,c </span><br><span class="line">	<span class="keyword">from</span> emp </span><br><span class="line">	<span class="keyword">where</span> empno<span class="operator">=</span>eno;</span><br><span class="line">	yearsal :<span class="operator">=</span> s<span class="operator">+</span>c;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--测试存储过程p_yearsal</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">	yearsal number(<span class="number">10</span>); <span class="comment">--定义变量放入存储过程改变其值</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	p_yearsal(<span class="number">7788</span>,yearsal); <span class="comment">--yearsal的值在存储过程内被改变</span></span><br><span class="line">	dbms_output.put_line(yearsal); <span class="comment">--结果：输出员工编号为7788的员工的年薪</span></span><br><span class="line">en</span><br></pre></td></tr></table></figure>

<blockquote>
<p>in和out类型参数的区别：凡是涉及到into查询语句赋值或 := 赋值操作的参数，都必须使用out来修饰 否则其余都用in</p>
</blockquote>
<h3 id="存储函数"><a href="#存储函数" class="headerlink" title="存储函数"></a>存储函数</h3><p>与存储过程区别：</p>
<ul>
<li>存储函数可以有一个返回值，而存储过程没有</li>
<li>存储过程和存储函数的参数都不能带长度</li>
<li>存储函数的返回值类型不能带长度</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--通过存储函数实现计算指定员工的年薪</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">function</span> f_yearsal(eno emp.empno<span class="operator">%</span>type) <span class="keyword">return</span> number <span class="comment">--这里参数和返回值类型不能带长度</span></span><br><span class="line"><span class="keyword">is</span></span><br><span class="line">	s number(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">select</span> sal<span class="operator">*</span><span class="number">12</span><span class="operator">+</span>nvl(comm,<span class="number">0</span>) <span class="keyword">into</span> s </span><br><span class="line">	<span class="keyword">from</span> emp</span><br><span class="line">    <span class="keyword">where</span> empno <span class="operator">=</span> eno;</span><br><span class="line">	<span class="keyword">return</span> s;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--测试存储函数f_yearsal</span></span><br><span class="line"><span class="comment">--存储函数在调用的时候，返回值需要接收，不接受会报错</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line">	sal_year number(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	sal_year :<span class="operator">=</span> f_yearsal(<span class="number">7788</span>); </span><br><span class="line">	dbms_output.put_line(sal_year);<span class="comment">--结果：输出员工编号为7788的员工的年薪</span></span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>

<p><strong>存储过程和存储函数的区别：</strong></p>
<ul>
<li>语法：<ul>
<li>关键字不一样</li>
<li>存储函数比存储过程多了两个return</li>
</ul>
</li>
<li>本质区别：<ul>
<li>存储函数有返回值，二存储过程没有返回值</li>
<li>如果存储过程想实现有返回值的业务，我们就必须使用out类型的参数</li>
<li>即便是存储过程使用out类型的参数，其本质也不是真的有了返回值</li>
<li>而是在存储过程内部给out类型参数赋值，在执行完毕后，我们直接拿到输出类型参数的值。</li>
</ul>
</li>
</ul>
<h3 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h3><p>制定一个规则，在【增删改】操作的时候，只要满足该规则，自动触发，无需调用。</p>
<ul>
<li>语句级触发器：不包含有for each row的</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 例:插入一条记录，输出&#x27;创建xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--创建一个触发器t1</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> t1</span><br><span class="line">after 		<span class="comment">--语句执行前还是后执行该触发器</span></span><br><span class="line"><span class="keyword">insert</span>		<span class="comment">--执行什么语句会触发</span></span><br><span class="line"><span class="keyword">on</span> person	<span class="comment">--作用哪个表的触发器</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dbms_output.put_line(<span class="string">&#x27;创建了一个person&#x27;</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--触发t1</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> person(pid, name, gender, birthday) <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="number">1</span>, to_date(<span class="string">&#x27;2020-7-17&#x27;</span>, <span class="string">&#x27;yyyy-MM-dd&#x27;</span>));</span><br></pre></td></tr></table></figure>
<ul>
<li><p>行级触发器：</p>
<p>包含有for each row的就是行级触发器。</p>
<p>加for each row是为了使用 :old 或者 :new 对象获取一行记录</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 例：不能给员工降薪</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> t2</span><br><span class="line">before</span><br><span class="line">updater</span><br><span class="line"><span class="keyword">on</span> emp</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> <span class="comment">--表示行级触发器</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	if :old.sal <span class="operator">&gt;</span> :new.sal <span class="keyword">then</span></span><br><span class="line">		<span class="comment">-- 抛出一个异常raise_application_error(-20001~-20999之间,&#x27;错误提示信息&#x27;);</span></span><br><span class="line">		raise_application_error(<span class="number">-20001</span>,<span class="string">&#x27;不能给员工降薪&#x27;</span>);</span><br><span class="line">	<span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 例：使用触发器实现主键自增</span></span><br><span class="line"><span class="comment">--分析：在用户插入操作之前，拿到即将插入的数据，给该数据中的主键列赋值，使用该功能用到行级触发器</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">trigger</span> auid</span><br><span class="line">before</span><br><span class="line"><span class="keyword">insert</span></span><br><span class="line"><span class="keyword">on</span> person</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">select</span> s_id_person.nextval <span class="keyword">into</span> :new.pid <span class="keyword">from</span> dual;</span><br><span class="line">	<span class="comment">--s_person 自定义序列号名字 </span></span><br><span class="line">	<span class="comment">--nextval 取序列的下一个值 </span></span><br><span class="line">	<span class="comment">--dual 是oracle的bai虚拟表du,不是真实存在的</span></span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure>



<h3 id="java调用存储过程或存储函数"><a href="#java调用存储过程或存储函数" class="headerlink" title="java调用存储过程或存储函数"></a>java调用存储过程或存储函数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--需要jar包</span><br><span class="line">	oracle10g == ojdbc14.jar</span><br><span class="line">	oracle11g == ojdbc6.jar</span><br><span class="line">--需要接口</span><br><span class="line">	CallableStatement</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OracleDemo</span> &#123;</span><br><span class="line">	<span class="comment">//测试连接oracl数据库</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">javaCallOracle</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">//加载数据库驱动</span></span><br><span class="line">		Class.forName(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>);</span><br><span class="line">		<span class="comment">//得到Connection连接</span></span><br><span class="line">		<span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:oracle:thin:@192.168.88.6:1521:orcl&quot;</span>,</span><br><span class="line">				<span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">		<span class="comment">//得到预编译的Statement对象</span></span><br><span class="line">		<span class="type">PreparedStatement</span> <span class="variable">pstm</span> <span class="operator">=</span> connection.prepareStatement(<span class="string">&quot;select * from emp where empno = ?&quot;</span>);</span><br><span class="line">		<span class="comment">//给参数赋值</span></span><br><span class="line">		pstm.setObject(<span class="number">1</span>, <span class="number">7788</span>);</span><br><span class="line">		<span class="comment">//执行数据库查询操作</span></span><br><span class="line">		<span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> pstm.executeQuery();</span><br><span class="line">		<span class="comment">//输出结果</span></span><br><span class="line">		<span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">			System.out.println(rs.getString(<span class="string">&quot;ename&quot;</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//释放资源</span></span><br><span class="line">		rs.close();</span><br><span class="line">		pstm.close();</span><br><span class="line">		connection.close();</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * java调用存储过程</span></span><br><span class="line"><span class="comment">	 * &#123;?= call &lt;procedure-name&gt;[(&lt;arg1&gt;,&lt;arg2&gt;, ...)]&#125;   调用存储函数使用</span></span><br><span class="line"><span class="comment">	 * &#123;call &lt;procedure-name&gt;[(&lt;arg1&gt;,&lt;arg2&gt;, ...)]&#125;   调用存储过程使用</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">javaCallProcedure</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">//加载数据库驱动</span></span><br><span class="line">		Class.forName(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>);</span><br><span class="line">		<span class="comment">//得到Connection连接</span></span><br><span class="line">		<span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:oracle:thin:@192.168.88.6:1521:orcl&quot;</span>,</span><br><span class="line">				<span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">		<span class="comment">//得到预编译的Statement对象</span></span><br><span class="line">		<span class="type">CallableStatement</span> <span class="variable">pstm</span> <span class="operator">=</span> connection.prepareCall(<span class="string">&quot;&#123;call p_yearsal(?, ?)&#125;&quot;</span>);<span class="comment">//call p_yearsal(?, ?)为存储过程，带两个参数</span></span><br><span class="line">		<span class="comment">//给参数赋值</span></span><br><span class="line">		pstm.setObject(<span class="number">1</span>, <span class="number">7788</span>);<span class="comment">//第一个参数,查询的id</span></span><br><span class="line">		pstm.registerOutParameter(<span class="number">2</span>, OracleTypes.NUMBER);<span class="comment">//无返回值，第二参数表示输出类型的参数==员工年薪</span></span><br><span class="line">		<span class="comment">//执行数据库查询操作</span></span><br><span class="line">		pstm.execute();</span><br><span class="line">		<span class="comment">//输出结果[第二个参数]</span></span><br><span class="line">		System.out.println(pstm.getObject(<span class="number">2</span>));</span><br><span class="line">		<span class="comment">//释放资源</span></span><br><span class="line">		pstm.close();</span><br><span class="line">		connection.close();</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * java调用存储函数</span></span><br><span class="line"><span class="comment">	 * &#123;?= call &lt;procedure-name&gt;[(&lt;arg1&gt;,&lt;arg2&gt;, ...)]&#125;   调用存储函数使用</span></span><br><span class="line"><span class="comment">	 * &#123;call &lt;procedure-name&gt;[(&lt;arg1&gt;,&lt;arg2&gt;, ...)]&#125;   调用存储过程使用</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">javaCallFunction</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">//加载数据库驱动</span></span><br><span class="line">		Class.forName(<span class="string">&quot;oracle.jdbc.driver.OracleDriver&quot;</span>);</span><br><span class="line">		<span class="comment">//得到Connection连接</span></span><br><span class="line">		<span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:oracle:thin:@192.168.88.6:1521:orcl&quot;</span>,</span><br><span class="line">                                                            <span class="string">&quot;root&quot;</span>,</span><br><span class="line">                                                            <span class="string">&quot;root&quot;</span>);</span><br><span class="line">		<span class="comment">//得到预编译的Statement对象</span></span><br><span class="line">		<span class="type">CallableStatement</span> <span class="variable">pstm</span> <span class="operator">=</span> connection.prepareCall(<span class="string">&quot;&#123;?= call f_yearsal(?)&#125;&quot;</span>);</span><br><span class="line">		<span class="comment">//给参数赋值</span></span><br><span class="line">		pstm.setObject(<span class="number">2</span>, <span class="number">7788</span>);  <span class="comment">//第二个？表示存储函数参数==查询的id</span></span><br><span class="line">		pstm.registerOutParameter(<span class="number">1</span>, OracleTypes.NUMBER);<span class="comment">//第一？表示存储函数返回值</span></span><br><span class="line">		<span class="comment">//执行数据库查询操作</span></span><br><span class="line">		pstm.execute();</span><br><span class="line">		<span class="comment">//输出结果[第一个参数]</span></span><br><span class="line">		System.out.println(pstm.getObject(<span class="number">1</span>));</span><br><span class="line">		<span class="comment">//释放资源</span></span><br><span class="line">		pstm.close();</span><br><span class="line">		connection.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/aiyblog/2021/04/24/sql/mysql-3-%E8%A7%86%E5%9B%BE%E3%80%81%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E3%80%81%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
              2021-04-24 14:19:52
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="Categories"></i>
                    
                    <span class="span--category">
                      <a href="/aiyblog/categories/sql/" title="sql">
                        <b>#</b> sql
                      </a>
                    </span>
                    
                  </span>
              
                  <span class="post-tags">
                    <i class="iconfont icon-tags mr-10" title="Tags"></i>
                    
                    <span class="span--tag mr-8">
                      <a href="/aiyblog/tags/sql/" title="sql">
                        #sql
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/aiyblog/2021/04/24/sql/mysql%E5%BC%82%E5%B8%B8%E6%8D%95%E8%8E%B7/" target="_self">
                <span>Next</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Oracle%E5%9F%BA%E7%A1%80"><span class="toc-text">Oracle基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%A1%8C%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="toc-text">单行函数：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-text">多行函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="toc-text">分组查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#oracle%E5%88%86%E9%A1%B5"><span class="toc-text">oracle分页</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-text">视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-text">索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pl-sql%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80"><span class="toc-text">pl&#x2F;sql编程语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E7%BB%93%E6%9E%84%EF%BC%9A"><span class="toc-text">流程结构：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87"><span class="toc-text">游标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-text">存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-text">存储函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-text">触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#java%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E6%88%96%E5%AD%98%E5%82%A8%E5%87%BD%E6%95%B0"><span class="toc-text">java调用存储过程或存储函数</span></a></li></ol></li></ol>
      
    </div>
  </div>

  
<script src="/aiyblog/js/catalog.js"></script>




    
      <div class="comments-container">
        




  
    <script async type="text/javascript" src="/aiyblog/plugins/valine.min.js" onload="loadValineSuc(this)"></script>
  

  <div id="vcomments"></div>

  <script>
    function loadValineSuc() {
      new Valine({
        el: '#vcomments',
        appId: 'ORcoqRY0dO24QWtD0xqwdcTX-gzGzoHsz',
        appKey: 'CgBvKrMwbKWnawHX1lpJV2R9',
        placeholder: 'Welcome!',
        avatar: 'retro',
        lang: 'en'
      })
    }
  </script>

    <style>
      .comments-container .v .vempty {
        display: none!important;
      }
    </style>




      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/xiaoaiying-i">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/xiaoaiying-i/aiyblog">Copyright © 2023 aiblog</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/aiyblog/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/aiyblog/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/aiyblog/js/colorscheme.js"></script>




		
        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + oracle%E5%9F%BA%E7%A1%80 + '&url=' + https%3A%2F%2Fxiaoaiying-i.github.io%2Faiyblog%2F2021%2F04%2F24%2Fsql%2Foracle%25E5%259F%25BA%25E7%25A1%2580%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=https://xiaoaiying-i.github.io/aiyblog/2021/04/24/sql/oracle%E5%9F%BA%E7%A1%80/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/aiyblog/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
