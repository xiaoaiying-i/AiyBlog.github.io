<!DOCTYPE html>
<html lang="en" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="John Doe" />
  <meta name="description" content="" />
  
  
  <title>
    
      springDataJpa初识 
      
      
      |
    
     Ai-blogs
  </title>

  
    <link rel="apple-touch-icon" href="/aiyblog/images/favicon.png">
    <link rel="icon" href="/aiyblog/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  <link rel="stylesheet" href="/aiyblog/css/main.css" />
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
  <!-- 代码块风格 -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/aiyblog/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/aiyblog/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/aiyblog/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/aiyblog/js/fancybox.js"></script>


  

  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/aiyblog/atom.xml" title="Ai-blogs" type="application/atom+xml">
</head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/aiyblog">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/aiyblog/images/ailog.png" alt="">
      
    </a>
    <div class="nickname"><a href="/aiyblog">Ai-Blog</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/aiyblog/index/">
          <a href="/aiyblog/index/">首页</a>
        </li>
      
        <li class="nav-item" data-path="/aiyblog/archives/">
          <a href="/aiyblog/archives/">归档</a>
        </li>
      
        <li class="nav-item" data-path="/aiyblog/categories/">
          <a href="/aiyblog/categories/">分类</a>
        </li>
      
        <li class="nav-item" data-path="/aiyblog/tags/">
          <a href="/aiyblog/tags/">标签</a>
        </li>
      
        <li class="nav-item" data-path="/aiyblog/friends/">
          <a href="/aiyblog/friends/">外链</a>
        </li>
      
        <li class="nav-item" data-path="/aiyblog/about/">
          <a href="/aiyblog/about/">关于</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/aiyblog/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/aiyblog/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/aiyblog/plugins/clipboard.min.js"></script>
  
  
<script src="/aiyblog/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">springDataJpa初识</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
          2020-01-26 19:19:52
        </span>
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="Categories"></i>
                
                <span class="span--category">
                  <a href="/aiyblog/categories/spring/" title="spring">
                    <b>#</b> spring
                  </a>
                </span>
                
              </span>
          
              <span class="post-tags">
                <i class="iconfont icon-tags mr-10" title="Tags"></i>
                
                <span class="span--tag mr-8">
                  <a href="/aiyblog/tags/spring/" title="spring">
                    #spring
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <p>jpa:java persistence api java持久化api</p>
<h2 id="orm思想"><a href="#orm思想" class="headerlink" title="orm思想"></a>orm思想</h2><ul>
<li>操作实体类相当于操作数据库表，不在重点关注sql语句</li>
<li>两个映射：1-实体类和表  2-属性和字段</li>
<li>实现orm思想的框架如：mybatis、hibernate</li>
</ul>
<h2 id="jpa规范"><a href="#jpa规范" class="headerlink" title="jpa规范"></a>jpa规范</h2><ul>
<li>jdbc规范：封装好具体操作数据库接口、方法，只需修改对应驱动</li>
<li>内部由接口和抽象类组成</li>
<li>jpa规范不干活，依托实现方式（如：hibernate）来操作。</li>
</ul>
<h2 id="jpa使用操作"><a href="#jpa使用操作" class="headerlink" title="jpa使用操作"></a>jpa使用操作</h2><p>1-jar依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.hibernate.version</span>&gt;</span>5.0.7.Final<span class="tag">&lt;/<span class="name">project.hibernate.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- junit --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- hibernate对jpa的支持包 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-entitymanager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- c3p0 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- log日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Mysql and MariaDB --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2-配置文件  需在class目录下的META-INF目录及名称为persistence.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">persistence</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/persistence&quot;</span> <span class="attr">version</span>=<span class="string">&quot;2.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--需配置persistence-unit节点</span></span><br><span class="line"><span class="comment">        持久化单元：</span></span><br><span class="line"><span class="comment">            name：持久化单元名称</span></span><br><span class="line"><span class="comment">            transaction-type:事务管理方式   JTA=分布式事务管理   RESOURCE_LOCAL=本地事务管理</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">persistence-unit</span> <span class="attr">name</span>=<span class="string">&quot;myJpa&quot;</span> <span class="attr">transaction-type</span>=<span class="string">&quot;RESOURCE_LOCAL&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jpa实现方式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">provider</span>&gt;</span>org.hibernate.jpa.HibernatePersistenceProvider<span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--数据库信息：</span></span><br><span class="line"><span class="comment">                用户名 javax.persistence.jdbc.user</span></span><br><span class="line"><span class="comment">                密码 javax.persistence.jdbc.password</span></span><br><span class="line"><span class="comment">                驱动 javax.persistence.jdbc.driver</span></span><br><span class="line"><span class="comment">                地址 javax.persistence.jdbc.url</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;javax.persistence.jdbc.url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///mydb&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--可选配置：配置jpa实现方式的配置信息</span></span><br><span class="line"><span class="comment">                显示sql    true=显示  false=不显示</span></span><br><span class="line"><span class="comment">                自动创建数据库表 :</span></span><br><span class="line"><span class="comment">                    create=程序运行时创建数据库表，有表先删再创建</span></span><br><span class="line"><span class="comment">                    update=程序运行时创建数据库表  有表不会创建</span></span><br><span class="line"><span class="comment">                    none=不会创建数据库表</span></span><br><span class="line"><span class="comment">             --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.show_sql&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hibernate.hbm2ddl.auto&quot;</span> <span class="attr">value</span>=<span class="string">&quot;update&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">persistence-unit</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">persistence</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3-实体类与表映射</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoai.domain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户实体类   需要配置映射关系</span></span><br><span class="line"><span class="comment"> *      1-实体类和表映射</span></span><br><span class="line"><span class="comment"> *      2-属性和字段映射</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  主键生成策略</span></span><br><span class="line"><span class="comment"> *      IDENTITY=自增   底层必须支持自增      mysql</span></span><br><span class="line"><span class="comment"> *      SEQUENCE=序列   底层必须支持序列      oracle</span></span><br><span class="line"><span class="comment"> *      TABLE=jpa提供的一种机制，通过一张数据库表的形式帮助我们完成主键自增</span></span><br><span class="line"><span class="comment"> *      AUTO=由程序自动帮助我们选择主键生成策略</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span>   <span class="comment">//1-1声明此类为实体类</span></span><br><span class="line"><span class="meta">@Table(name = &quot;mjfs14_customer&quot;)</span>   <span class="comment">//1-2配置实体类和表映射</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Customer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2-1配置属性字段映射</span></span><br><span class="line">    <span class="meta">@Id</span>  <span class="comment">//声明主键</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>  <span class="comment">//配置主键生成策略  IDENTITY=自增 (要求：底层数据库必须支持自动增长)</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;cust_id&quot;)</span>  <span class="comment">//对应数据库字段名称</span></span><br><span class="line">    <span class="keyword">private</span> Long custId; <span class="comment">//客户主键</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;cust_name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String custName;<span class="comment">//客户名称</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;cust_source&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String custSource;<span class="comment">//客户来源</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;cust_level&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String custLevel;<span class="comment">//客户级别</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;cust_industry&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String custIndustry;<span class="comment">//客户所属行业</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;cust_phone&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String custPhone;<span class="comment">//客户联系方式</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;cust_address&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String custAddress;<span class="comment">//客户地址</span></span><br><span class="line"></span><br><span class="line">    ......对应属性get和set方法以及toString方法</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>4-具体CRUD操作</p>
<p>EntityManager相关方法</p>
<ul>
<li>presist(对象)  保存</li>
<li>merge(对象)  更新  先查询得到对象，修改对象然后执行修改</li>
<li>remove(对象)  删除  先查询得到对象，传入对象进行删除</li>
<li>find(待封装对象class，id)/getRefrence(待封装对象class，id)  根据id查询 find立即加载，getRefrence延时加载（懒加载）  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoai.test;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sun.xml.internal.txw2.TXW;</span><br><span class="line"><span class="keyword">import</span> com.xiaoai.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> com.xiaoai.utils.JpaUtils;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jpa相应操作</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * jpa操作步骤：</span></span><br><span class="line"><span class="comment"> *      1-加载配置文件创建工厂（实体管理器工厂）对象</span></span><br><span class="line"><span class="comment"> *          EntityManagerFactory创建过程比较浪费资源</span></span><br><span class="line"><span class="comment"> *          特点：线程安全对象：多个线程访问同一个EntityManagerFactory不会有线程安全问题</span></span><br><span class="line"><span class="comment"> *          ---解决EntityManagerFactory创建过程浪费资源（耗时）问题？</span></span><br><span class="line"><span class="comment"> *          思路：创建公共EntityManagerFactory对象   解决：java中可以使用静态代码块形式创建EntityManagerFactory</span></span><br><span class="line"><span class="comment"> *      2-通过实体管理类工厂获取实体管理器</span></span><br><span class="line"><span class="comment"> *          方法：createEntityManager</span></span><br><span class="line"><span class="comment"> *          内部维护很多内容：数据库信息、缓存信息、所有实体类管理器对象等</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *          createEntityManager对象：实体类管理器   方法：</span></span><br><span class="line"><span class="comment"> *              beginTransaction=创建事务对象</span></span><br><span class="line"><span class="comment"> *              presist=保存</span></span><br><span class="line"><span class="comment"> *              merge=更新</span></span><br><span class="line"><span class="comment"> *              remove=删除</span></span><br><span class="line"><span class="comment"> *              find/getRefrence=根据id查询</span></span><br><span class="line"><span class="comment"> *      3-获取事务对象，开启事务</span></span><br><span class="line"><span class="comment"> *          EntityTransaction 事务对象</span></span><br><span class="line"><span class="comment"> *              begin=开启事务</span></span><br><span class="line"><span class="comment"> *              commit=提交事务</span></span><br><span class="line"><span class="comment"> *              rellback=回滚</span></span><br><span class="line"><span class="comment"> *      4-完成相关增删改查操作</span></span><br><span class="line"><span class="comment"> *      5-提交事务（回滚事务）</span></span><br><span class="line"><span class="comment"> *      6-释放资源</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JpaTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  -----测试jpa的增加 presist</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1-加载配置文件创建工厂（实体管理器工厂）  根据持久化单元名称创建实体类工厂</span></span><br><span class="line">        <span class="type">EntityManagerFactory</span> <span class="variable">factory</span> <span class="operator">=</span> Persistence.createEntityManagerFactory(<span class="string">&quot;myJpa&quot;</span>);</span><br><span class="line">        <span class="comment">//2-获取实体类管理器</span></span><br><span class="line">        <span class="type">EntityManager</span> <span class="variable">em</span> <span class="operator">=</span> factory.createEntityManager();</span><br><span class="line">        <span class="comment">//3-获取事务管理    打开事务</span></span><br><span class="line">        <span class="type">EntityTransaction</span> <span class="variable">tx</span> <span class="operator">=</span> em.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//4-执行操作  增加 presist</span></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>();</span><br><span class="line">        customer.setCustName(<span class="string">&quot;xiaoai&quot;</span>);</span><br><span class="line">        customer.setCustIndustry(<span class="string">&quot;it&quot;</span>);</span><br><span class="line">        em.persist(customer);</span><br><span class="line">        <span class="comment">//5-提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//6-释放资源</span></span><br><span class="line">        em.close();</span><br><span class="line">        factory.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----根据id查询  使用find方法</span></span><br><span class="line"><span class="comment">     *  1-查询对象就是当前待查询对象本身</span></span><br><span class="line"><span class="comment">     *  2-调用find方法时，就会发送sql语句查询数据库</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  立即加载：得到的即对象本身，调用方法就完成加载</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFind</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取管理器</span></span><br><span class="line">        <span class="type">EntityManager</span> <span class="variable">entityManager</span> <span class="operator">=</span> JpaUtils.getEntityManager();  <span class="comment">//通过JpaUtils封装生成同一EntityManagerFactory对象，减少资源耗费及耗时</span></span><br><span class="line">        <span class="comment">//获取事务 打开事务</span></span><br><span class="line">        <span class="type">EntityTransaction</span> <span class="variable">tx</span> <span class="operator">=</span> entityManager.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//操作</span></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> entityManager.find(Customer.class, <span class="number">1l</span>);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//关闭  由于使用同一个EntityManagerFactory对象，所以其暂时不能关闭</span></span><br><span class="line">        entityManager.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----根据id查询  使用getReference方法</span></span><br><span class="line"><span class="comment">     *  1-查询对象是一个动态代理对象</span></span><br><span class="line"><span class="comment">     *  2-不会即时发送sql语句查询数据库，当调用查询结果对象的时候，才会发送查询的sql语句（即什么时候用什么时候发送）</span></span><br><span class="line"><span class="comment">     *  延时加载（懒加载）：得到的是一个动态代理对象  什么时候用什么时候加载</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  一般使用延时加载，</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetReference</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取管理器</span></span><br><span class="line">        <span class="type">EntityManager</span> <span class="variable">entityManager</span> <span class="operator">=</span> JpaUtils.getEntityManager();</span><br><span class="line">        <span class="comment">//获取事务 打开事务</span></span><br><span class="line">        <span class="type">EntityTransaction</span> <span class="variable">tx</span> <span class="operator">=</span> entityManager.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//操作</span></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> entityManager.getReference(Customer.class, <span class="number">1l</span>);<span class="comment">//getReference</span></span><br><span class="line">        System.out.println(customer);</span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//关闭  由于使用同一个EntityManagerFactory对象，所以其暂时不能关闭</span></span><br><span class="line">        entityManager.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----删除   remove</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRemove</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取管理器</span></span><br><span class="line">        <span class="type">EntityManager</span> <span class="variable">entityManager</span> <span class="operator">=</span> JpaUtils.getEntityManager();</span><br><span class="line">        <span class="comment">//获取事务 打开事务</span></span><br><span class="line">        <span class="type">EntityTransaction</span> <span class="variable">tx</span> <span class="operator">=</span> entityManager.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//操作  删除 先查后删</span></span><br><span class="line">        <span class="comment">//--1-根据id查询客户</span></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> entityManager.find(Customer.class, <span class="number">1l</span>);<span class="comment">//getReference</span></span><br><span class="line">        <span class="comment">//--2-传入所查询结果删除</span></span><br><span class="line">        entityManager.remove(customer);</span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//关闭  由于使用同一个EntityManagerFactory对象，所以其暂时不能关闭</span></span><br><span class="line">        entityManager.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----更新   merge</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取管理器</span></span><br><span class="line">        <span class="type">EntityManager</span> <span class="variable">entityManager</span> <span class="operator">=</span> JpaUtils.getEntityManager();</span><br><span class="line">        <span class="comment">//获取事务 打开事务</span></span><br><span class="line">        <span class="type">EntityTransaction</span> <span class="variable">tx</span> <span class="operator">=</span> entityManager.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//操作  更新  先查询获取对象，修改对象后更新对象</span></span><br><span class="line">        <span class="comment">//--1-根据id查询客户</span></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> entityManager.find(Customer.class, <span class="number">2l</span>);<span class="comment">//getReference</span></span><br><span class="line">        <span class="comment">//--2-修改对象信息</span></span><br><span class="line">        customer.setCustIndustry(<span class="string">&quot;net&quot;</span>);</span><br><span class="line">        <span class="comment">//--2-传入所查询结果删除</span></span><br><span class="line">        entityManager.merge(customer);</span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//关闭  由于使用同一个EntityManagerFactory对象，所以其暂时不能关闭</span></span><br><span class="line">        entityManager.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
EntityManagerFactory封装<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoai.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManagerFactory;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Persistence;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解决实体管理器工厂的浪费资源和耗时问题</span></span><br><span class="line"><span class="comment"> *  通过静态代码块的形式，当程序第一次访问此工具类是，创建一个公共的实体管理器工厂对象</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  1-第一次访问getEntityManager方法，经静态代码块创建factory对象，再调用方法创建一个EntityManager对象</span></span><br><span class="line"><span class="comment"> *  2-第二次访问getEntityManager方法，直接通过一个已经创建好的factory对象创建EntityManager对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JpaUtils</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> EntityManagerFactory factory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//加载配置文件，创建EntityManagerFactory</span></span><br><span class="line">        factory  = Persistence.createEntityManagerFactory(<span class="string">&quot;myJpa&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用来获取EntityManager对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> EntityManager <span class="title function_">getEntityManager</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> factory.createEntityManager();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="jpql查询"><a href="#jpql查询" class="headerlink" title="jpql查询"></a>jpql查询</h2><p>java persistence query language   jpa提供的一种查询语句  和sql差不多</p>
<p><strong>sql</strong>：查询的是表和表中的字段<br><strong>jpql</strong>：查询的是实体类和类中属性</p>
<p>步骤：</p>
<ul>
<li>1-EntityManagerFactory 工厂</li>
<li>2-EntityManager 实体类管理器</li>
<li>3-EntityTransaction 打开事务</li>
<li>4-Query：jpql具体查询语句获取query对象，query对象执行查询  （jpa直接通过EntityManager对象进行操作）</li>
<li>5-提交事务</li>
<li>6-释放资源</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoai.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoai.utils.JpaUtils;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityTransaction;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Query;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jpql查询</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JpqlTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----查询全部</span></span><br><span class="line"><span class="comment">     *      sql：select * from mjfs14_customer</span></span><br><span class="line"><span class="comment">     *      jqpl：from com.xiaoai.domain.Customer(可以使用全限定类名也可以简写： from Customer)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindAll</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取entityManager对象</span></span><br><span class="line">        <span class="type">EntityManager</span> <span class="variable">entityManager</span> <span class="operator">=</span> JpaUtils.getEntityManager();</span><br><span class="line">        <span class="comment">//开启事务</span></span><br><span class="line">        <span class="type">EntityTransaction</span> <span class="variable">tx</span> <span class="operator">=</span> entityManager.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//操作</span></span><br><span class="line">            <span class="comment">//--1获取query对象</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">jpql</span> <span class="operator">=</span> <span class="string">&quot;from com.xiaoai.domain.Customer&quot;</span>;</span><br><span class="line">            <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> entityManager.createQuery(jpql);</span><br><span class="line">            <span class="comment">//--2具体操作，封装结果集</span></span><br><span class="line">            <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> query.getResultList();</span><br><span class="line">            <span class="keyword">for</span> (Object obj:list ) &#123;</span><br><span class="line">                System.out.println(obj);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        entityManager.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*结果如下：</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_, customer0_.cust_address as cust_add2_0_, customer0_.cust_industry as cust_ind3_0_, customer0_.cust_level as cust_lev4_0_, customer0_.cust_name as cust_nam5_0_, customer0_.cust_phone as cust_pho6_0_, customer0_.cust_source as cust_sou7_0_ from mjfs14_customer customer0_</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=1, custName=&#x27;xiaoai2&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;it&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=2, custName=&#x27;xiaoai&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;net&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=3, custName=&#x27;xiaoai3&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;无业游民&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=4, custName=&#x27;小艾&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;教育&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----倒叙查询</span></span><br><span class="line"><span class="comment">     *      sql: select * from mjfs14_customer order by cust_id DESC</span></span><br><span class="line"><span class="comment">     *      jpql: from Customer order by custId desc</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testOrders</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取entityManager对象</span></span><br><span class="line">        <span class="type">EntityManager</span> <span class="variable">entityManager</span> <span class="operator">=</span> JpaUtils.getEntityManager();</span><br><span class="line">        <span class="comment">//开启事务</span></span><br><span class="line">        <span class="type">EntityTransaction</span> <span class="variable">tx</span> <span class="operator">=</span> entityManager.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//操作</span></span><br><span class="line">            <span class="comment">//--1获取query对象</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">jpql</span> <span class="operator">=</span> <span class="string">&quot;from Customer order by custId desc&quot;</span>;</span><br><span class="line">            <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> entityManager.createQuery(jpql);</span><br><span class="line">            <span class="comment">//--2具体操作，封装结果集</span></span><br><span class="line">            <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> query.getResultList();</span><br><span class="line">            <span class="keyword">for</span> (Object obj:list ) &#123;</span><br><span class="line">                System.out.println(obj);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        entityManager.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*结果如下：</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_, customer0_.cust_address as cust_add2_0_, customer0_.cust_industry as cust_ind3_0_, customer0_.cust_level as cust_lev4_0_, customer0_.cust_name as cust_nam5_0_, customer0_.cust_phone as cust_pho6_0_, customer0_.cust_source as cust_sou7_0_ from mjfs14_customer customer0_ order by customer0_.cust_id desc</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=4, custName=&#x27;小艾&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;教育&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=3, custName=&#x27;xiaoai3&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;无业游民&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=2, custName=&#x27;xiaoai&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;net&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=1, custName=&#x27;xiaoai2&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;it&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----统计查询</span></span><br><span class="line"><span class="comment">     *      sql: select count(cust_id) from mjfs14_customer</span></span><br><span class="line"><span class="comment">     *      jpql: select count(custId) from Customer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCount</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取entityManager对象</span></span><br><span class="line">        <span class="type">EntityManager</span> <span class="variable">entityManager</span> <span class="operator">=</span> JpaUtils.getEntityManager();</span><br><span class="line">        <span class="comment">//开启事务</span></span><br><span class="line">        <span class="type">EntityTransaction</span> <span class="variable">tx</span> <span class="operator">=</span> entityManager.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//操作</span></span><br><span class="line">            <span class="comment">//--1获取query对象</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">jpql</span> <span class="operator">=</span> <span class="string">&quot;select count(custId) from Customer&quot;</span>;</span><br><span class="line">            <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> entityManager.createQuery(jpql);</span><br><span class="line">            <span class="comment">//--2具体操作，封装结果集</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> query.getSingleResult();<span class="comment">//得到唯一的结果集</span></span><br><span class="line">        System.out.println(result);</span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        entityManager.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*结果如下：</span></span><br><span class="line"><span class="comment">        Hibernate: select count(customer0_.cust_id) as col_0_0_ from mjfs14_customer customer0_</span></span><br><span class="line"><span class="comment">        4</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----分页查询</span></span><br><span class="line"><span class="comment">     *      sql: select * from mjfs14_customer limit ?,?</span></span><br><span class="line"><span class="comment">     *      jpql: from Customer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPaged</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取entityManager对象</span></span><br><span class="line">        <span class="type">EntityManager</span> <span class="variable">entityManager</span> <span class="operator">=</span> JpaUtils.getEntityManager();</span><br><span class="line">        <span class="comment">//开启事务</span></span><br><span class="line">        <span class="type">EntityTransaction</span> <span class="variable">tx</span> <span class="operator">=</span> entityManager.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//操作</span></span><br><span class="line">            <span class="comment">//--1获取query对象</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">jpql</span> <span class="operator">=</span> <span class="string">&quot;from Customer&quot;</span>;</span><br><span class="line">            <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> entityManager.createQuery(jpql);</span><br><span class="line">            <span class="comment">//--2具体操作，封装结果集</span></span><br><span class="line">            <span class="comment">//----设置参数（分页参数）</span></span><br><span class="line">            query.setFirstResult(<span class="number">0</span>);<span class="comment">//从下标0开始查</span></span><br><span class="line">            query.setMaxResults(<span class="number">2</span>);<span class="comment">//每次查询两条</span></span><br><span class="line">            <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> query.getResultList();</span><br><span class="line">            <span class="keyword">for</span> (Object obj:list ) &#123;</span><br><span class="line">                System.out.println(obj);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        entityManager.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*结果如下：</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_, customer0_.cust_address as cust_add2_0_, customer0_.cust_industry as cust_ind3_0_, customer0_.cust_level as cust_lev4_0_, customer0_.cust_name as cust_nam5_0_, customer0_.cust_phone as cust_pho6_0_, customer0_.cust_source as cust_sou7_0_ from mjfs14_customer customer0_ limit ?</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=1, custName=&#x27;xiaoai2&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;it&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=2, custName=&#x27;xiaoai&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;net&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----条件查询</span></span><br><span class="line"><span class="comment">     *      sql: select * from mjfs14_customer where cust_name like ?</span></span><br><span class="line"><span class="comment">     *      jpql: from Customer where custName like ?</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCondition</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//获取entityManager对象</span></span><br><span class="line">        <span class="type">EntityManager</span> <span class="variable">entityManager</span> <span class="operator">=</span> JpaUtils.getEntityManager();</span><br><span class="line">        <span class="comment">//开启事务</span></span><br><span class="line">        <span class="type">EntityTransaction</span> <span class="variable">tx</span> <span class="operator">=</span> entityManager.getTransaction();</span><br><span class="line">        tx.begin();</span><br><span class="line">        <span class="comment">//操作</span></span><br><span class="line">            <span class="comment">//--1获取query对象</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">jpql</span> <span class="operator">=</span> <span class="string">&quot;from Customer where custName like ?&quot;</span>;</span><br><span class="line">            <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> entityManager.createQuery(jpql);</span><br><span class="line">            <span class="comment">//--2具体操作，封装结果集</span></span><br><span class="line">            <span class="comment">//----设置参数（占位符参数）</span></span><br><span class="line">            query.setParameter(<span class="number">1</span>,<span class="string">&quot;xiaoai%&quot;</span>);<span class="comment">//参数：1=第几个占位符  2=代替值</span></span><br><span class="line">            <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> query.getResultList();</span><br><span class="line">            <span class="keyword">for</span> (Object obj:list ) &#123;</span><br><span class="line">                System.out.println(obj);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        tx.commit();</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        entityManager.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*结果如下：</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_, customer0_.cust_address as cust_add2_0_, customer0_.cust_industry as cust_ind3_0_, customer0_.cust_level as cust_lev4_0_, customer0_.cust_name as cust_nam5_0_, customer0_.cust_phone as cust_pho6_0_, customer0_.cust_source as cust_sou7_0_ from mjfs14_customer customer0_ where customer0_.cust_name like ?</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=1, custName=&#x27;xiaoai2&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;it&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=2, custName=&#x27;xiaoai&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;net&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=3, custName=&#x27;xiaoai3&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;无业游民&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="spring-data-jpa"><a href="#spring-data-jpa" class="headerlink" title="spring data jpa"></a>spring data jpa</h2><p>相互关系：我们写的java代码——》spring data jpa——》jpa规范——》hibernate（封装jdbc）——》数据库</p>
<h3 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h3><ul>
<li>导入jar<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.2.4.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">hibernate.version</span>&gt;</span>5.0.7.Final<span class="tag">&lt;/<span class="name">hibernate.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.6.6<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">c3p0.version</span>&gt;</span>0.9.1.2<span class="tag">&lt;/<span class="name">c3p0.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- junit单元测试 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring beg --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- spring end --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- hibernate beg --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-entitymanager<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;hibernate.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.1.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- hibernate end --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- c3p0 beg --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;c3p0.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- c3p0 end --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- log end --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- log end --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- el beg 使用spring data jpa 必须引入 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.glassfish.web<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.el<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- el end --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>配置spring配置文件（配置spring data jpa整合）<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jdbc</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:jpa</span>=<span class="string">&quot;http://www.springframework.org/schema/data/jpa&quot;</span> <span class="attr">xmlns:task</span>=<span class="string">&quot;http://www.springframework.org/schema/task&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/data/jpa</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/data/jpa/spring-jpa.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--spring 和 spring data jpa的配置--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1==创建entityManagerFactory对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;entityManagerFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!--数据源--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;packagesToScan&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.xiaoai.domain&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span><span class="comment">&lt;!--扫描实体类所在包--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;persistenceProvider&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.hibernate.jpa.HibernatePersistenceProvider&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span><span class="comment">&lt;!--配置jpa的实现厂家--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--JPA的供应商适配器--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jpaVendorAdapter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--配置是否自动创建数据库表--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;generateDdl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span><span class="comment">&lt;!--是否自动创建表--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;database&quot;</span> <span class="attr">value</span>=<span class="string">&quot;MYSQL&quot;</span> /&gt;</span> <span class="comment">&lt;!--数据库类型--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databasePlatform&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.hibernate.dialect.MySQLDialect&quot;</span> /&gt;</span><span class="comment">&lt;!--数据库方言：数据库支持的特有语法--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;showSql&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span><span class="comment">&lt;!--是否显示sql语句：即是否打印到控制台--&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jpa方言，高级特性--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jpaDialect&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.jpa.vendor.HibernateJpaDialect&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--2=创建数据库连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;user&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///mydb?useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--3=整合spring dataJpa--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jpa:repositories</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xiaoai.dao&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">transaction-manager-ref</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">entity-manager-factory-ref</span>=<span class="string">&quot;entityManagerFactory&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">jpa:repositories</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--4=配置事务管理器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;entityManagerFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;entityManagerFactory&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--5=spring声明式事务--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--6=配置包扫描--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.xiaoai&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>编写实体类及映射   同jpa一致</li>
<li>编写dao层<ul>
<li>只要编写dao接口，不需编写实现类</li>
<li>接口需继承两接口：JpaRepository, JpaSpecificationExecutor   接口需提供响应泛型<ul>
<li>JpaRepository&lt;操作的实体类类型,实体类类型主键属性的类型&gt;  封装了基本curd操作</li>
<li>JpaSpecificationExecutor&lt;操作的实体类类型&gt;   封装了复杂查询（分页等）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoai.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoai.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaSpecificationExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CustomerDao</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Customer,Long&gt;,JpaSpecificationExecutor&lt;Customer&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li>注入接口对象，直接使用<h3 id="接口相关方法"><a href="#接口相关方法" class="headerlink" title="接口相关方法"></a>接口相关方法</h3></li>
<li>findOne(id)  根据id查询</li>
<li>save(对象)  对象标识主键 不存在=新增   存在=修改（修改需要先查询然后修改，不要直接创建相同id的对象然后直接执行修改）</li>
<li>delete(id)  根据id删除 </li>
<li>findAll()  查询所有</li>
<li>count（）  统计总数量</li>
<li>exists(id)  查询id为xx的数据是否存在 <ul>
<li>思路1：查询id为xx数据，判断值是否为空</li>
<li>思路2：判断id为xx的数据数量，数量为0即不存在  JPA即是该种思路</li>
</ul>
</li>
<li>getOne(id)  根据id查询  测试方法上需要 @Transactional支持<ul>
<li>与findOne区别：findOne底层调用entityManager的find()方法即立即加载，GetOne底层调用entityManager的getRefrence()方法即延时加载。为了延时加载正常执行需要加上事务支持</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoai.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoai.dao.CustomerDao;</span><br><span class="line"><span class="keyword">import</span> com.xiaoai.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerDaoTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CustomerDao customerDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----根据id查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindOne</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Customer</span> <span class="variable">one</span> <span class="operator">=</span> customerDao.findOne(<span class="number">3l</span>);</span><br><span class="line">        System.out.println(one);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*结果</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_0_, customer0_.cust_address as cust_add2_0_0_, customer0_.cust_industry as cust_ind3_0_0_, customer0_.cust_level as cust_lev4_0_0_, customer0_.cust_name as cust_nam5_0_0_, customer0_.cust_phone as cust_pho6_0_0_, customer0_.cust_source as cust_sou7_0_0_ from mjfs14_customer customer0_ where customer0_.cust_id=?</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=3, custName=&#x27;xiaoai3&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;无业游民&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----save：保存或者更新，根据传入的对象主键id是否存在判断新增或更新</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//新增</span></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Customer</span>();</span><br><span class="line">        customer.setCustName(<span class="string">&quot;程序员&quot;</span>);</span><br><span class="line">        customer.setCustLevel(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        customer.setCustIndustry(<span class="string">&quot;it&quot;</span>);</span><br><span class="line">        customerDao.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----save：保存或者更新，根据传入的对象主键id是否存在判断新增或更新</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        Customer customer = new Customer();</span></span><br><span class="line"><span class="comment">//        customer.setCustId(5l); //id为5的数据已经存在，</span></span><br><span class="line"><span class="comment">//        customer.setCustName(&quot;程序员&quot;);</span></span><br><span class="line"><span class="comment">//        customerDao.save(customer);</span></span><br><span class="line">        <span class="comment">//如果像上面那样修改，则id为5的数据名称改为了程序员，但其他属性将变为空。</span></span><br><span class="line">        <span class="comment">// 因为修改是查询然后修改，这里直接定义了新对象设置了名称其他属性都为空，即用其替换了原来的5号数据</span></span><br><span class="line">        <span class="comment">//应该先查询获得对象，然后修改对象再执行修改。</span></span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> customerDao.findOne(<span class="number">5l</span>);</span><br><span class="line">        customer.setCustName(<span class="string">&quot;程序员&quot;</span>);<span class="comment">//修改编号5数据的名称为程序员</span></span><br><span class="line">        customerDao.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span>&#123;</span><br><span class="line">        customerDao.delete(<span class="number">6l</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----查询所有</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindAll</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Customer&gt; all = customerDao.findAll();</span><br><span class="line">        <span class="keyword">for</span> (Customer c : all) &#123;</span><br><span class="line">            System.out.println(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 测试结果：</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_, customer0_.cust_address as cust_add2_0_, customer0_.cust_industry as cust_ind3_0_, customer0_.cust_level as cust_lev4_0_, customer0_.cust_name as cust_nam5_0_, customer0_.cust_phone as cust_pho6_0_, customer0_.cust_source as cust_sou7_0_ from mjfs14_customer customer0_</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=1, custName=&#x27;xiaoai2&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;it&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=2, custName=&#x27;xiaoai&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;net&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=3, custName=&#x27;xiaoai3&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;无业游民&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=4, custName=&#x27;小艾&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;教育&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=5, custName=&#x27;程序员&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;it&#x27;, custLevel=&#x27;3&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *-----统计查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCount</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> customerDao.count();</span><br><span class="line">        System.out.println(count);</span><br><span class="line">        <span class="comment">/*测试结果：</span></span><br><span class="line"><span class="comment">        Hibernate: select count(*) as col_0_0_ from mjfs14_customer customer0_</span></span><br><span class="line"><span class="comment">        5</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----判断数据是否存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testExists</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">exists</span> <span class="operator">=</span> customerDao.exists(<span class="number">4l</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;是否存在：&quot;</span>+exists);</span><br><span class="line">        <span class="comment">/*测试结果：</span></span><br><span class="line"><span class="comment">        Hibernate: select count(*) as col_0_0_ from mjfs14_customer customer0_ where customer0_.cust_id=? and 1=1</span></span><br><span class="line"><span class="comment">        是否存在：true</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * -----根据id查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span>  <span class="comment">//保证getOne正常运行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetOne</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Customer</span> <span class="variable">one</span> <span class="operator">=</span> customerDao.getOne(<span class="number">4l</span>);</span><br><span class="line">        System.out.println(one);</span><br><span class="line">        <span class="comment">/*测试结果：</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_0_, customer0_.cust_address as cust_add2_0_0_, customer0_.cust_industry as cust_ind3_0_0_, customer0_.cust_level as cust_lev4_0_0_, customer0_.cust_name as cust_nam5_0_0_, customer0_.cust_phone as cust_pho6_0_0_, customer0_.cust_source as cust_sou7_0_0_ from mjfs14_customer customer0_ where customer0_.cust_id=?</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=4, custName=&#x27;小艾&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;教育&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="定义jpql-sql语句查询"><a href="#定义jpql-sql语句查询" class="headerlink" title="定义jpql/sql语句查询"></a>定义jpql/sql语句查询</h3><ul>
<li>特有查询：需要在dao接口上配置方法</li>
<li>新添加的方法上使用注解形式配置jpql语句</li>
<li>注解：@query<ul>
<li>注解属性value=jpql语句或sql语句   </li>
<li>注解属性nativeQuery=false（使用jqpl查询）或true（使用本地查询：即sql查询）</li>
</ul>
</li>
<li>jpql更深层封装：只需要按照springDataJpa提供的方法名称规则定义方法，不需要去配置jpql语句，也可以完成查询<ul>
<li>findBy+属性名称() = 查询  如：findByCustName   根据方法名称(findBy)解析要查询 from 实体类 where 属性名称（如custName) = 参数</li>
<li>findBy+属性名称+查询方式（like、isnull） 如：findByCustNameLike</li>
<li>findBy+属性名+查询方式+多条件连接符(and、or)+属性名+查询方式(精准匹配可以省略查询方式)  如：findByCustNameLikeAndCustIndustry<br>接口定义的方法<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoai.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoai.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaSpecificationExecutor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.Modifying;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.Query;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义符合springdataJpa的dao层接口规范</span></span><br><span class="line"><span class="comment"> *      JpaRepository&lt;操作的实体类类型,实体类类型主键属性的类型&gt;</span></span><br><span class="line"><span class="comment"> *          封装了基本curd操作</span></span><br><span class="line"><span class="comment"> *     JpaSpecificationExecutor&lt;操作的实体类类型&gt;</span></span><br><span class="line"><span class="comment"> *         封装了复杂查询（分页）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CustomerDao</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Customer,Long&gt;,JpaSpecificationExecutor&lt;Customer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//===============================================================自定义jpql执行方法</span></span><br><span class="line">    <span class="comment">//使用注解@Query</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----根据客户名称查询客户</span></span><br><span class="line">    <span class="meta">@Query(value = &quot;from Customer where custName=?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Customer <span class="title function_">jpqlFindByName</span><span class="params">(String custName)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----根据客户名称id查询客户</span></span><br><span class="line">    <span class="comment">// 需要注意多占位符的匹配关系问题</span></span><br><span class="line">    <span class="comment">// 默认情况下，占位符位置需要和方法参数中位置保持一致</span></span><br><span class="line">    <span class="comment">// 但也可以指定占位符参数位置：通过【?索引】的方式指定此占位符的取值来源 如?1 表示该占位符取方法第一个参数</span></span><br><span class="line">    <span class="meta">@Query(value = &quot;from Customer where custName=?1 and custId=?2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Customer <span class="title function_">jpqlFindByNameAndId</span><span class="params">(String name,Long id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----根据id更新客户名称</span></span><br><span class="line">    <span class="meta">@Query(value = &quot;update Customer set custName=?2 where custId=?1&quot;)</span></span><br><span class="line">    <span class="meta">@Modifying</span> <span class="comment">//声明此方法是用来进行更新操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">jpqlUpdateNameById</span><span class="params">(Long custId,String custName)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//===============================================================自定义sql语句执行方法</span></span><br><span class="line">    <span class="comment">// @Query  属性：value=jpql语句或sql语句   nativeQuery=false（使用jqpl查询）或true（使用本地查询：即使用sql查询）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----查询所有</span></span><br><span class="line">    <span class="meta">@Query(value = &quot;select * from mjfs14_customer&quot;,nativeQuery = true)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Object[]&gt; findSql();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----根据名称模糊查询</span></span><br><span class="line">    <span class="meta">@Query(value = &quot;select * from mjfs14_customer where cust_name like ?1&quot;,nativeQuery = true)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Object[]&gt; findSqlByName(String name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//===============================================================jpql的深层封装：根据springDataJpa提供的命名方法</span></span><br><span class="line">    <span class="comment">// findByXxx = 查询  Xxx即对象属性即查询条件  如：findByCustName   根据方法名称(findBy)解析要查询 from 实体类 where xxx(属性名称如custName) = 参数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----根据名称查询</span></span><br><span class="line">    <span class="keyword">public</span> Customer <span class="title function_">findByCustName</span><span class="params">(String custName)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----根据名称模糊查询</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Customer&gt; <span class="title function_">findByCustNameLike</span><span class="params">(String custName)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----查询客户名模糊匹配和客户所属行业精准匹配</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Customer&gt; <span class="title function_">findByCustNameLikeAndCustIndustry</span><span class="params">(String custName,String custIndustry)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
测试 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xiaoai.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xiaoai.dao.CustomerDao;</span><br><span class="line"><span class="keyword">import</span> com.xiaoai.domain.Customer;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.annotation.Rollback;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.management.Query;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JpqlTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    CustomerDao customerDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----自定义jpql：根据名称查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJpqlFindByName</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> customerDao.jpqlFindByName(<span class="string">&quot;xiaoai&quot;</span>);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">        <span class="comment">/* 执行结果：</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_, customer0_.cust_address as cust_add2_0_, customer0_.cust_industry as cust_ind3_0_, customer0_.cust_level as cust_lev4_0_, customer0_.cust_name as cust_nam5_0_, customer0_.cust_phone as cust_pho6_0_, customer0_.cust_source as cust_sou7_0_ from mjfs14_customer customer0_ where customer0_.cust_name=?</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=2, custName=&#x27;xiaoai&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;net&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//-----自定义jpql：根据名称和id查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJpqlFindByNameAndId</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> customerDao.jpqlFindByNameAndId(<span class="string">&quot;xiaoai&quot;</span>,<span class="number">2l</span>);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">        <span class="comment">/* 执行结果：</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_, customer0_.cust_address as cust_add2_0_, customer0_.cust_industry as cust_ind3_0_, customer0_.cust_level as cust_lev4_0_, customer0_.cust_name as cust_nam5_0_, customer0_.cust_phone as cust_pho6_0_, customer0_.cust_source as cust_sou7_0_ from mjfs14_customer customer0_ where customer0_.cust_name=? and customer0_.cust_id=?</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=2, custName=&#x27;xiaoai&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;net&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//-----自定义jpql：根据id更新客户名称</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Transactional</span> <span class="comment">//spring data jpa 使用jpql完成更新、删除操作需要手动添加事务支持 执行结束后其会自动回滚事务</span></span><br><span class="line">    <span class="meta">@Rollback(value = false)</span> <span class="comment">//设置不自动回滚</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJpqlUpdateNameById</span><span class="params">()</span>&#123;</span><br><span class="line">       customerDao.jpqlUpdateNameById(<span class="number">3l</span>,<span class="string">&quot;程序员小艾&quot;</span>);</span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> customerDao.findOne(<span class="number">3l</span>);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">        <span class="comment">/* 执行结果：</span></span><br><span class="line"><span class="comment">        Hibernate: update mjfs14_customer set cust_name=? where cust_id=?</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_0_, customer0_.cust_address as cust_add2_0_0_, customer0_.cust_industry as cust_ind3_0_0_, customer0_.cust_level as cust_lev4_0_0_, customer0_.cust_name as cust_nam5_0_0_, customer0_.cust_phone as cust_pho6_0_0_, customer0_.cust_source as cust_sou7_0_0_ from mjfs14_customer customer0_ where customer0_.cust_id=?</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=3, custName=&#x27;程序员小艾&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;无业游民&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----自定义sql：查询所有</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindSql</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Object[]&gt; list = customerDao.findSql();</span><br><span class="line">        <span class="keyword">for</span> (Object[] obj : list) &#123;</span><br><span class="line">            System.out.println(Arrays.toString(obj));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 执行结果：</span></span><br><span class="line"><span class="comment">        Hibernate: select * from mjfs14_customer</span></span><br><span class="line"><span class="comment">        [1, xiaoai2, null, it, null, null, null]</span></span><br><span class="line"><span class="comment">        [2, xiaoai, null, net, null, null, null]</span></span><br><span class="line"><span class="comment">        [3, 程序员小艾, null, 无业游民, null, null, null]</span></span><br><span class="line"><span class="comment">        [4, 小艾, null, 教育, null, null, null]</span></span><br><span class="line"><span class="comment">        [5, 程序员, null, it, 3, null, null]</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">//-----自定义sql：根据名称模糊查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindSqlByName</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Object[]&gt; list = customerDao.findSqlByName(<span class="string">&quot;xiaoai%&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Object[] obj : list) &#123;</span><br><span class="line">            System.out.println(Arrays.toString(obj));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 执行结果：</span></span><br><span class="line"><span class="comment">        Hibernate: select * from mjfs14_customer where cust_name like ?</span></span><br><span class="line"><span class="comment">        [1, xiaoai2, null, it, null, null, null]</span></span><br><span class="line"><span class="comment">        [2, xiaoai, null, net, null, null, null]</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-----jpql进一步封装：根据名称查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindByName</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Customer</span> <span class="variable">customer</span> <span class="operator">=</span> customerDao.findByCustName(<span class="string">&quot;小艾&quot;</span>);</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">        <span class="comment">/* 执行结果：</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_, customer0_.cust_address as cust_add2_0_, customer0_.cust_industry as cust_ind3_0_, customer0_.cust_level as cust_lev4_0_, customer0_.cust_name as cust_nam5_0_, customer0_.cust_phone as cust_pho6_0_, customer0_.cust_source as cust_sou7_0_ from mjfs14_customer customer0_ where customer0_.cust_name=?</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=4, custName=&#x27;小艾&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;教育&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//-----jpql进一步封装：根据名称模糊查询</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindByNameLike</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Customer&gt; customers = customerDao.findByCustNameLike(<span class="string">&quot;xiaoai%&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Customer c : customers) &#123;</span><br><span class="line">            System.out.println(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 执行结果：</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_, customer0_.cust_address as cust_add2_0_, customer0_.cust_industry as cust_ind3_0_, customer0_.cust_level as cust_lev4_0_, customer0_.cust_name as cust_nam5_0_, customer0_.cust_phone as cust_pho6_0_, customer0_.cust_source as cust_sou7_0_ from mjfs14_customer customer0_ where customer0_.cust_name like ?</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=1, custName=&#x27;xiaoai2&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;it&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=2, custName=&#x27;xiaoai&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;net&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//-----jpql进一步封装：客户名模糊匹配和客户所属行业精准匹配</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindByNAndI</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Customer&gt; customers = customerDao.findByCustNameLikeAndCustIndustry(<span class="string">&quot;xiaoai%&quot;</span>,<span class="string">&quot;it&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Customer c : customers) &#123;</span><br><span class="line">            System.out.println(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 执行结果：</span></span><br><span class="line"><span class="comment">        Hibernate: select customer0_.cust_id as cust_id1_0_, customer0_.cust_address as cust_add2_0_, customer0_.cust_industry as cust_ind3_0_, customer0_.cust_level as cust_lev4_0_, customer0_.cust_name as cust_nam5_0_, customer0_.cust_phone as cust_pho6_0_, customer0_.cust_source as cust_sou7_0_ from mjfs14_customer customer0_ where (customer0_.cust_name like ?) and customer0_.cust_industry=?</span></span><br><span class="line"><span class="comment">        Customer&#123;custId=1, custName=&#x27;xiaoai2&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;it&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="specifications动态查询"><a href="#specifications动态查询" class="headerlink" title="specifications动态查询"></a>specifications动态查询</h3><p>Specification即查询条件<br>即接口继承的JpaSpecificationExecutor类所提供的方法列表：</p>
<ul>
<li>T findOne(Specification<T> var1);  单个查询</li>
<li>List<T> findAll(Specification<T> var1); 查询列表</li>
<li>Page<T> findAll(Specification<T> var1, Pageable var2); 分页查询 pageable=分页参数</li>
<li>List<T> findAll(Specification<T> var1, Sort var2); 查询列表  sort=排序参数</li>
<li>long count(Specification<T> var1);  统计查询</li>
</ul>
<p><code>**使用**</code></p>
<ul>
<li><p>创建Specification对象，通过匿名内部类构建查询条件，再把对象传入JpaSpecificationExecutor提供的方法中完成查询</p>
<ul>
<li>匿名内部类方法参数：Root<Customer>  获取查询的对象属性  get()=获取属性</li>
<li>匿名内部类方法参数：CriteriaBuilder  用于构建条件   .equal()=精准查询  .like()=模糊查询  .and()=连接属性</li>
</ul>
</li>
<li><p>equal:直接得到path对象，然后进行比较</p>
</li>
<li><p>gt，lt，ge，le，like：得到path对象，根据path指定比较的参数类型，再去进行比较  指定参数类型格式：path对象.as(类型字节码对象) 如： Predicate like = criteriaBuilder.like(custName.as(String.class), “xiaoai%”);</p>
</li>
<li><p>排序：创建排序对象做参数传入对应方法   Sort sort = new Sort(Sort.Direction.DESC,”custId”);//倒序</p>
</li>
<li><p>分页：创建分页对象做参数传入对应方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSpec5</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//添加分页</span></span><br><span class="line">    <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageRequest</span>(<span class="number">0</span>,<span class="number">3</span>); <span class="comment">//创建分页对象 参数：1=当前查询的页数（从0开始） 2=每页查询数量</span></span><br><span class="line">    Page&lt;Customer&gt; pageCustomer = customerDao.findAll(<span class="literal">null</span>, pageable);<span class="comment">//Specification传入空，表示查询全部</span></span><br><span class="line">    System.out.println(<span class="string">&quot;总条数：&quot;</span>+pageCustomer.getTotalElements());</span><br><span class="line">    System.out.println(<span class="string">&quot;总页数：&quot;</span>+pageCustomer.getTotalPages());</span><br><span class="line">    List&lt;Customer&gt; content = pageCustomer.getContent();<span class="comment">//获取当前页数据列表</span></span><br><span class="line">    <span class="keyword">for</span> (Customer c : content) &#123;</span><br><span class="line">        System.out.println(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*执行结果：</span></span><br><span class="line"><span class="comment">    Hibernate: select count(customer0_.cust_id) as col_0_0_ from mjfs14_customer customer0_</span></span><br><span class="line"><span class="comment">    Hibernate: select customer0_.cust_id as cust_id1_0_, customer0_.cust_address as cust_add2_0_, customer0_.cust_industry as cust_ind3_0_, customer0_.cust_level as cust_lev4_0_, customer0_.cust_name as cust_nam5_0_, customer0_.cust_phone as cust_pho6_0_, customer0_.cust_source as cust_sou7_0_ from mjfs14_customer customer0_ limit ?</span></span><br><span class="line"><span class="comment">    总条数：5</span></span><br><span class="line"><span class="comment">    总页数：2</span></span><br><span class="line"><span class="comment">    Customer&#123;custId=1, custName=&#x27;xiaoai2&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;it&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">    Customer&#123;custId=2, custName=&#x27;xiaoai&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;net&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">    Customer&#123;custId=3, custName=&#x27;程序员小艾&#x27;, custSource=&#x27;null&#x27;, custIndustry=&#x27;无业游民&#x27;, custLevel=&#x27;null&#x27;, custAddress=&#x27;null&#x27;, custPhone=&#x27;null&#x27;&#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="多表操作"><a href="#多表操作" class="headerlink" title="多表操作"></a>多表操作</h2><h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a><strong>一对多</strong></h3></li>
<li><p>主要是配置实体类映射时和其他实体类的关系</p>
<ul>
<li>一对一</li>
<li>一对多、多对一   注：在一的一方维护外键即可，不需要一和多都维护外键</li>
<li>多对多</li>
</ul>
</li>
<li><p>可以添加实体类属性并配置其关系映射可完成多表操作</p>
<ul>
<li>配置相互关系可用实体类间的包含关系，即在实体类中添加另一个实体类作为属性。并需要配置其关系：1-声明表关系  2-配置外键<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">多的一方：</span><br><span class="line"><span class="meta">@OneToMany(targetEntity = LinkMan.class)</span>  <span class="comment">//配置一对多关系  需对方字节码对象</span></span><br><span class="line"><span class="meta">@JoinColumn(name = &quot;lkm_cust_id&quot;,referencedColumnName = &quot;cust_id&quot;)</span>  <span class="comment">//name=从表的外键字段，referencedColumnName=主表的主键字段</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;LinkMan&gt; linkmans = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">一的一方：</span><br><span class="line"><span class="comment">//配置联系人到客户多对一关系   1-声明表关系  2-配置外键</span></span><br><span class="line"><span class="meta">@ManyToOne(targetEntity = Customer.class)</span></span><br><span class="line"><span class="meta">@JoinColumn(name = &quot;lkm_cust_id&quot;,referencedColumnName = &quot;cust_id&quot;)</span> <span class="comment">//name=从表的外键字段，referencedColumnName=本表的主键字段</span></span><br><span class="line"><span class="keyword">private</span> Customer customer;</span><br><span class="line"></span><br><span class="line">多的一方放弃维护外键：mappedBy=<span class="string">&quot;对方配置关系的属性名&quot;</span> </span><br><span class="line"><span class="meta">@OneToMany(mappedBy=&quot;customer&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;LinkMan&gt; linkmans = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();  <span class="comment">//放弃外键维护权，表关系交给一的一方维护</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>一对多删除：删除【一一方】需要考虑，因为有可能【多一方】引入了【一一方】   在【一一方】删除时则需要使用级联删除</p>
<ul>
<li>级联：操作一个对象的同时操作他的关联对象</li>
<li>级联删除：删除【一一方】的同时删除关联其的【多一方】的所有数据。想级联删除需要在操作的主体即【一一方】的实体类上添加级联属性（配置级联：cascade）<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">配置级联：</span><br><span class="line"><span class="meta">@OneToMany(mappedBy=&quot;customer&quot;,cascade = CascadeType.ALL)</span> <span class="comment">//CascadeType.ALL=所有操作（insert、delete等）都可级联</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;LinkMan&gt; linkmans = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a><strong>多对多</strong></h3><ul>
<li>创建实体类配置映射，通过包含关系加入另一实体类做属性，配置实体类间多对多关系<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//建立关联   1-声明表关系   2-配置中间表（包含两个外键）</span></span><br><span class="line"><span class="meta">@ManyToMany(targetEntity = Role.class)</span></span><br><span class="line"><span class="meta">@JoinTable(name = &quot;mjfs14_user_role&quot;, //中间表名称     @JoinColumn和@inverseJoinColumns参数：name=对应外键字段  referencedColumnName=对应主键字段</span></span><br><span class="line"><span class="meta">        joinColumns = &#123;@JoinColumn(name = &quot;center_user_id&quot;,referencedColumnName = &quot;user_id&quot;)&#125;, // 当前对象在中间表中对应外键配置</span></span><br><span class="line"><span class="meta">        inverseJoinColumns = &#123;@JoinColumn(name = &quot;center_role_id&quot;,referencedColumnName = &quot;role_id&quot;)&#125; //对方对象在中间表中对应外键配置</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;Role&gt; roles = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br></pre></td></tr></table></figure></li>
<li>放弃外键维护权：两方都是多，随便一方都可以放弃外键维护权  但是一般被选择一方放弃  放弃维护权和【一对多】一致</li>
<li>级联操作：删除对象以及对象关联的对象以及中间表中关联的数据  操作和一对多一致</li>
</ul>
<p><strong>对象导航查询</strong></p>
<ul>
<li>查询一个对象时，通过此对象查询其关联对象  操作即：直接通过对象.getxxx()方法即之前创建关联的对象属性时的get方法获取即可  内部自动查询好了</li>
<li>一方查询多方：默认使用延迟加载（因为在一方查询多方，有可能多方有太多数据，立即加载后不用则极大浪费内存）   多方查询一方：默认使用立即加载（多方查询一方时由于只多一条数据，影响不大，所以立即查询了）</li>
<li>延迟加载： 默认即使用延迟加载的形式查询的   可以修改延迟加载为立即加载 即在实体类映射中通过@OneToMany属性fetch配置 EAGER=立即加载 LAZY=延迟加载<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">配置立即加载：</span><br><span class="line"><span class="comment">//使用注解形式配置多表关系  1-声明关系  2-配置外键</span></span><br><span class="line"><span class="meta">@OneToMany(mappedBy=&quot;customer&quot;,cascade = CascadeType.ALL,fetch = FetchType.EAGER )</span> <span class="comment">//CascadeType.ALL=所有操作（insert、delete等）都可级联  FetchType.EAGER</span></span><br><span class="line"><span class="keyword">private</span> Set&lt;LinkMan&gt; linkmans = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br></pre></td></tr></table></figure></li>
</ul>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/aiyblog/2020/01/26/spring/springCloud%E5%88%9D%E8%AF%86/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
              2020-01-26 19:19:52
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="Categories"></i>
                    
                    <span class="span--category">
                      <a href="/aiyblog/categories/spring/" title="spring">
                        <b>#</b> spring
                      </a>
                    </span>
                    
                  </span>
              
                  <span class="post-tags">
                    <i class="iconfont icon-tags mr-10" title="Tags"></i>
                    
                    <span class="span--tag mr-8">
                      <a href="/aiyblog/tags/spring/" title="spring">
                        #spring
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/aiyblog/2020/01/26/spring/spring%E5%88%9D%E8%AF%86/" target="_self">
                <span>Next</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#orm%E6%80%9D%E6%83%B3"><span class="toc-text">orm思想</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jpa%E8%A7%84%E8%8C%83"><span class="toc-text">jpa规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jpa%E4%BD%BF%E7%94%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">jpa使用操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jpql%E6%9F%A5%E8%AF%A2"><span class="toc-text">jpql查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring-data-jpa"><span class="toc-text">spring data jpa</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="toc-text">基础使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E7%9B%B8%E5%85%B3%E6%96%B9%E6%B3%95"><span class="toc-text">接口相关方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89jpql-sql%E8%AF%AD%E5%8F%A5%E6%9F%A5%E8%AF%A2"><span class="toc-text">定义jpql&#x2F;sql语句查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#specifications%E5%8A%A8%E6%80%81%E6%9F%A5%E8%AF%A2"><span class="toc-text">specifications动态查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">多表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A"><span class="toc-text">一对多</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A"><span class="toc-text">多对多</span></a></li></ol></li></ol>
      
    </div>
  </div>

  
<script src="/aiyblog/js/catalog.js"></script>




    
      <div class="comments-container">
        




  
    <script async type="text/javascript" src="/aiyblog/plugins/valine.min.js" onload="loadValineSuc(this)"></script>
  

  <div id="vcomments"></div>

  <script>
    function loadValineSuc() {
      new Valine({
        el: '#vcomments',
        appId: 'ORcoqRY0dO24QWtD0xqwdcTX-gzGzoHsz',
        appKey: 'CgBvKrMwbKWnawHX1lpJV2R9',
        placeholder: 'Welcome!',
        avatar: 'retro',
        lang: 'en'
      })
    }
  </script>

    <style>
      .comments-container .v .vempty {
        display: none!important;
      }
    </style>




      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/xiaoaiying-i">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/xiaoaiying-i/aiyblog">Copyright © 2023 aiblog</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/aiyblog/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/aiyblog/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/aiyblog/js/colorscheme.js"></script>




		
        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + springDataJpa%E5%88%9D%E8%AF%86 + '&url=' + https%3A%2F%2Fxiaoaiying-i.github.io%2Faiyblog%2F2020%2F01%2F26%2Fspring%2FspringDataJpa%25E5%2588%259D%25E8%25AF%2586%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=https://xiaoaiying-i.github.io/aiyblog/2020/01/26/spring/springDataJpa%E5%88%9D%E8%AF%86/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/aiyblog/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
